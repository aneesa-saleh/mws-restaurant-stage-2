"use strict";

var restaurant;
var newMap;
var matchesMediaQuery;
var mediaQuery = '(min-width: 800px)';
/**
 * Initialize map as soon as the page is loaded.
 */

document.addEventListener('DOMContentLoaded', function (event) {
  initMap();

  if (window.matchMedia) {
    matchesMediaQuery = window.matchMedia(mediaQuery).matches;
  }

  updateRestaurantContainerAria(); // set initial aria values

  registerServiceWorker();
});
/**
 * Initialize leaflet map
 */

initMap = function initMap() {
  fetchRestaurantFromURL(function (error, restaurant) {
    var MAPBOX_API_KEY = 'pk.eyJ1IjoiYW5lZXNhLXNhbGVoIiwiYSI6ImNqa2xmZHVwMDFoYW4zdnAwYWplMm53bHEifQ.V11dDOtEnWSwTxY-C8mJLw';

    if (error) {
      // Got an error!
      console.error(error);
    } else {
      self.newMap = L.map('map', {
        center: [restaurant.latlng.lat, restaurant.latlng.lng],
        zoom: 16,
        scrollWheelZoom: false
      });
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}', {
        mapboxToken: MAPBOX_API_KEY,
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(newMap);
      fillBreadcrumb();
      DBHelper.mapMarkerForRestaurant(self.restaurant, self.newMap);
    }
  });
};
/**
* Update aria-hidden values of the visible and accessible restaurant containers
*/


window.addEventListener('resize', function () {
  if (window.matchMedia) {
    var nextMatchesMediaQuery = window.matchMedia(mediaQuery).matches;

    if (nextMatchesMediaQuery !== matchesMediaQuery) {
      // only update aria when layout changes
      matchesMediaQuery = nextMatchesMediaQuery;
      updateRestaurantContainerAria();
    }
  }
});
/**
* Set aria-hidden values for visible and regular restaurant containers
* Accessible restaurant container is off screen
* It is required to maintain screen reading order when the layout shifts
*/

updateRestaurantContainerAria = function updateRestaurantContainerAria() {
  var restaurantContainer = document.getElementById('restaurant-container');
  var accessibleRestaurantContainer = document.getElementById('accessible-restaurant-container');

  if (matchesMediaQuery) {
    // larger layout, screen reading order off
    restaurantContainer.setAttribute('aria-hidden', 'true');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'false');
  } else {
    // use regular reading order
    restaurantContainer.setAttribute('aria-hidden', 'false');
    accessibleRestaurantContainer.setAttribute('aria-hidden', 'true');
  }
};
/**
 * Get current restaurant from page URL.
 */


fetchRestaurantFromURL = function fetchRestaurantFromURL(callback) {
  if (self.restaurant) {
    // restaurant already fetched!
    callback(null, self.restaurant);
    return;
  }

  var id = getParameterByName('id');

  if (!id) {
    // no id found in URL
    error = 'No restaurant id in URL';
    callback(error, null);
  } else {
    DBHelper.fetchRestaurantById(id, function (error, restaurant) {
      self.restaurant = restaurant;

      if (!restaurant) {
        console.error(error);
        return;
      }

      fillRestaurantHTML();
      callback(null, restaurant);
    });
  }
};
/**
 * Create restaurant HTML and add it to the webpage
 */


fillRestaurantHTML = function fillRestaurantHTML() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var name = document.getElementById('restaurant-name');
  name.innerHTML = restaurant.name;
  var address = document.getElementById('restaurant-address');
  address.innerHTML += restaurant.address;
  var picture = document.getElementById('restaurant-picture');
  var sourceLarge = document.createElement('source');
  sourceLarge.media = '(min-width: 800px)';
  sourceLarge.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'large',
    wide: true
  });
  sourceLarge.type = 'image/jpeg';
  picture.appendChild(sourceLarge);
  var sourceMedium = document.createElement('source');
  sourceMedium.media = '(min-width: 600px)';
  sourceMedium.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'medium'
  });
  sourceMedium.type = 'image/jpeg';
  picture.appendChild(sourceMedium);
  var sourceSmall = document.createElement('source');
  sourceSmall.srcset = DBHelper.imageUrlForRestaurant(restaurant, {
    size: 'small'
  });
  sourceSmall.type = 'image/jpeg';
  picture.appendChild(sourceSmall);
  var image = document.createElement('img');
  image.className = 'restaurant-img'; // set default size in case picture element is not supported

  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = restaurant.alt;
  picture.appendChild(image);
  var accessibleRestaurantImage = document.getElementById('accessible-restaurant-img');
  accessibleRestaurantImage.setAttribute('aria-label', restaurant.alt);
  var cuisine = document.getElementById('restaurant-cuisine');
  cuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type);
  var accessibleRestaurantCuisine = document.getElementById('accessible-restaurant-cuisine');
  accessibleRestaurantCuisine.innerHTML = "Cuisine: ".concat(restaurant.cuisine_type); // fill operating hours

  if (restaurant.operating_hours) {
    fillRestaurantHoursHTML();
  } // fill reviews


  fillReviewsHTML();
};
/**
 * Create restaurant operating hours HTML table and add it to the webpage.
 */


fillRestaurantHoursHTML = function fillRestaurantHoursHTML() {
  var operatingHours = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.operating_hours;
  var hours = document.getElementById('restaurant-hours');

  for (var key in operatingHours) {
    if (Object.prototype.hasOwnProperty.call(operatingHours, key)) {
      var row = document.createElement('tr');
      var day = document.createElement('td');
      day.innerHTML = key;
      row.appendChild(day);
      var time = document.createElement('td');
      time.innerHTML = operatingHours[key];
      row.appendChild(time);
      hours.appendChild(row);
    }
  }
};
/**
 * Create all reviews HTML and add them to the webpage.
 */


fillReviewsHTML = function fillReviewsHTML() {
  var reviews = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant.reviews;
  var container = document.getElementById('reviews-container');
  var title = document.createElement('h2');
  title.innerHTML = 'Reviews';
  container.appendChild(title);

  if (!reviews) {
    var noReviews = document.createElement('p');
    noReviews.innerHTML = 'No reviews yet!';
    container.appendChild(noReviews);
    return;
  }

  var ul = document.getElementById('reviews-list');
  reviews.forEach(function (review) {
    ul.appendChild(createReviewHTML(review));
  });
  container.appendChild(ul);
};
/**
 * Create review HTML and add it to the webpage.
 */


createReviewHTML = function createReviewHTML(review) {
  var article = document.createElement('article');
  article.className = 'review';
  var headerSpan = document.createElement('span');
  headerSpan.className = 'review-header';
  var name = document.createElement('p');
  name.innerHTML = review.name;
  name.className = 'review-name';
  headerSpan.appendChild(name);
  var date = document.createElement('p');
  date.innerHTML = review.date;
  date.className = 'review-date';
  headerSpan.appendChild(date);
  article.appendChild(headerSpan);
  var contentSpan = document.createElement('span');
  contentSpan.className = 'review-content';
  var rating = document.createElement('p');
  rating.innerHTML = "Rating: ".concat(review.rating);
  rating.className = 'review-rating';
  contentSpan.appendChild(rating);
  var comments = document.createElement('p');
  comments.innerHTML = review.comments;
  contentSpan.appendChild(comments);
  article.appendChild(contentSpan);
  return article;
};
/**
 * Add restaurant name to the breadcrumb navigation menu
 */


fillBreadcrumb = function fillBreadcrumb() {
  var restaurant = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : self.restaurant;
  var breadcrumb = document.getElementById('breadcrumb');
  var li = document.createElement('li');
  li.innerHTML = restaurant.name;
  breadcrumb.appendChild(li);
};
/**
 * Get a parameter by name from page URL.
 */


getParameterByName = function getParameterByName(name, url) {
  url = url || window.location.href;
  name = name.replace(/[\[\]]/g, '\\$&');
  var regex = new RegExp("[?&]".concat(name, "(=([^&#]*)|&|#|$)"));
  var results = regex.exec(url);
  if (!results) return null;
  if (!results[2]) return '';
  return decodeURIComponent(results[2].replace(/\+/g, ' '));
};

registerServiceWorker = function registerServiceWorker() {
  if (!navigator.serviceWorker) return;
  navigator.serviceWorker.register('/service-worker.js').catch(function (error) {
    return console.log(error);
  });
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJyZXN0YXVyYW50IiwibmV3TWFwIiwibWF0Y2hlc01lZGlhUXVlcnkiLCJtZWRpYVF1ZXJ5IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJpbml0TWFwIiwid2luZG93IiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJ1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsImZldGNoUmVzdGF1cmFudEZyb21VUkwiLCJlcnJvciIsIk1BUEJPWF9BUElfS0VZIiwiY29uc29sZSIsInNlbGYiLCJMIiwibWFwIiwiY2VudGVyIiwibGF0bG5nIiwibGF0IiwibG5nIiwiem9vbSIsInNjcm9sbFdoZWVsWm9vbSIsInRpbGVMYXllciIsIm1hcGJveFRva2VuIiwibWF4Wm9vbSIsImF0dHJpYnV0aW9uIiwiaWQiLCJhZGRUbyIsImZpbGxCcmVhZGNydW1iIiwiREJIZWxwZXIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwibmV4dE1hdGNoZXNNZWRpYVF1ZXJ5IiwicmVzdGF1cmFudENvbnRhaW5lciIsImdldEVsZW1lbnRCeUlkIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIiLCJzZXRBdHRyaWJ1dGUiLCJjYWxsYmFjayIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJuYW1lIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsInBpY3R1cmUiLCJzb3VyY2VMYXJnZSIsImNyZWF0ZUVsZW1lbnQiLCJtZWRpYSIsInNyY3NldCIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNpemUiLCJ3aWRlIiwidHlwZSIsImFwcGVuZENoaWxkIiwic291cmNlTWVkaXVtIiwic291cmNlU21hbGwiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImFsdCIsImFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UiLCJjdWlzaW5lIiwiY3Vpc2luZV90eXBlIiwiYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5IiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicm93IiwiZGF5IiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJ0aXRsZSIsIm5vUmV2aWV3cyIsInVsIiwiZm9yRWFjaCIsInJldmlldyIsImNyZWF0ZVJldmlld0hUTUwiLCJhcnRpY2xlIiwiaGVhZGVyU3BhbiIsImRhdGUiLCJjb250ZW50U3BhbiIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsImxpIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJjYXRjaCIsImxvZyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxVQUFKO0FBQ0EsSUFBSUMsTUFBSjtBQUNBLElBQUlDLGlCQUFKO0FBQ0EsSUFBTUMsVUFBVSxHQUFHLG9CQUFuQjtBQUVBOzs7O0FBR0FDLFFBQVEsQ0FBQ0MsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLFVBQUNDLEtBQUQsRUFBVztBQUN2REMsRUFBQUEsT0FBTzs7QUFDUCxNQUFJQyxNQUFNLENBQUNDLFVBQVgsRUFBdUI7QUFDckJQLElBQUFBLGlCQUFpQixHQUFHTSxNQUFNLENBQUNDLFVBQVAsQ0FBa0JOLFVBQWxCLEVBQThCTyxPQUFsRDtBQUNEOztBQUNEQyxFQUFBQSw2QkFBNkIsR0FMMEIsQ0FLdEI7O0FBQ2pDQyxFQUFBQSxxQkFBcUI7QUFDdEIsQ0FQRDtBQVNBOzs7O0FBR0FMLE9BQU8s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LENBQWEsU0FBYixFQUF3QixNQUF4QixDQUFQO0FBQ0EsTUFBTUMsS0FBSyxHQUFHLElBQUlDLE1BQUosZUFBa0J6RCxJQUFsQix1QkFBZDtBQUdBLE1BQU0wRCxPQUFPLEdBQUdGLEtBQUssQ0FBQ0csSUFBTixDQUFXUCxHQUFYLENBQWhCO0FBQ0EsTUFBSSxDQUFDTSxPQUFMLEVBQWMsT0FBTyxJQUFQO0FBQ2QsTUFBSSxDQUFDQSxPQUFPLENBQUMsQ0FBRCxDQUFaLEVBQWlCLE9BQU8sRUFBUDtBQUNqQixTQUFPRSxrQkFBa0IsQ0FBQ0YsT0FBTyxDQUFDLENBQUQsQ0FBUCxDQUFXSCxPQUFYLENBQW1CLEtBQW5CLEVBQTBCLEdBQTFCLENBQUQsQ0FBekI7QUFDRCxDQVZEOztBQVlBdkYscUJBQXFCLEdBQUcsaUNBQU07QUFDNUIsTUFBSSxDQUFDNkYsU0FBUyxDQUFDQyxhQUFmLEVBQThCO0FBRTlCRCxFQUFBQSxTQUFTLENBQUNDLGFBQVYsQ0FBd0JDLFFBQXhCLENBQWlDLG9CQUFqQyxFQUNHQyxLQURILENBQ1MsVUFBQTlGLEtBQUs7QUFBQSxXQUFJRSxPQUFPLENBQUM2RixHQUFSLENBQVkvRixLQUFaLENBQUo7QUFBQSxHQURkO0FBRUQsQ0FMRCIsInNvdXJjZXNDb250ZW50IjpbImxldCByZXN0YXVyYW50O1xudmFyIG5ld01hcDtcbmxldCBtYXRjaGVzTWVkaWFRdWVyeTtcbmNvbnN0IG1lZGlhUXVlcnkgPSAnKG1pbi13aWR0aDogODAwcHgpJztcblxuLyoqXG4gKiBJbml0aWFsaXplIG1hcCBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xuICBpbml0TWFwKCk7XG4gIGlmICh3aW5kb3cubWF0Y2hNZWRpYSkge1xuICAgIG1hdGNoZXNNZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEobWVkaWFRdWVyeSkubWF0Y2hlcztcbiAgfVxuICB1cGRhdGVSZXN0YXVyYW50Q29udGFpbmVyQXJpYSgpOyAvLyBzZXQgaW5pdGlhbCBhcmlhIHZhbHVlc1xuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgbGVhZmxldCBtYXBcbiAqL1xuaW5pdE1hcCA9ICgpID0+IHtcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcbiAgICBjb25zdCBNQVBCT1hfQVBJX0tFWSA9ICdway5leUoxSWpvaVlXNWxaWE5oTFhOaGJHVm9JaXdpWVNJNkltTnFhMnhtWkhWd01ERm9ZVzR6ZG5Bd1lXcGxNbTUzYkhFaWZRLlYxMWRET3RFbldTd1R4WS1DOG1KTHcnO1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5uZXdNYXAgPSBMLm1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICAgIHpvb206IDE2LFxuICAgICAgICBzY3JvbGxXaGVlbFpvb206IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBMLnRpbGVMYXllcignaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59Jywge1xuICAgICAgICBtYXBib3hUb2tlbjogTUFQQk9YX0FQSV9LRVksXG4gICAgICAgIG1heFpvb206IDE4LFxuICAgICAgICBhdHRyaWJ1dGlvbjogJ01hcCBkYXRhICZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvXCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzLCAnXG4gICAgICAgICAgKyAnPGEgaHJlZj1cImh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1zYS8yLjAvXCI+Q0MtQlktU0E8L2E+LCAnXG4gICAgICAgICAgKyAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JyxcbiAgICAgICAgaWQ6ICdtYXBib3guc3RyZWV0cycsXG4gICAgICB9KS5hZGRUbyhuZXdNYXApO1xuICAgICAgZmlsbEJyZWFkY3J1bWIoKTtcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm5ld01hcCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuKiBVcGRhdGUgYXJpYS1oaWRkZW4gdmFsdWVzIG9mIHRoZSB2aXNpYmxlIGFuZCBhY2Nlc3NpYmxlIHJlc3RhdXJhbnQgY29udGFpbmVyc1xuKi9cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7XG4gIGlmICh3aW5kb3cubWF0Y2hNZWRpYSkge1xuICAgIGNvbnN0IG5leHRNYXRjaGVzTWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKG1lZGlhUXVlcnkpLm1hdGNoZXM7XG4gICAgaWYgKG5leHRNYXRjaGVzTWVkaWFRdWVyeSAhPT0gbWF0Y2hlc01lZGlhUXVlcnkpIHsgLy8gb25seSB1cGRhdGUgYXJpYSB3aGVuIGxheW91dCBjaGFuZ2VzXG4gICAgICBtYXRjaGVzTWVkaWFRdWVyeSA9IG5leHRNYXRjaGVzTWVkaWFRdWVyeTtcbiAgICAgIHVwZGF0ZVJlc3RhdXJhbnRDb250YWluZXJBcmlhKCk7XG4gICAgfVxuICB9XG59KTtcblxuLyoqXG4qIFNldCBhcmlhLWhpZGRlbiB2YWx1ZXMgZm9yIHZpc2libGUgYW5kIHJlZ3VsYXIgcmVzdGF1cmFudCBjb250YWluZXJzXG4qIEFjY2Vzc2libGUgcmVzdGF1cmFudCBjb250YWluZXIgaXMgb2ZmIHNjcmVlblxuKiBJdCBpcyByZXF1aXJlZCB0byBtYWludGFpbiBzY3JlZW4gcmVhZGluZyBvcmRlciB3aGVuIHRoZSBsYXlvdXQgc2hpZnRzXG4qL1xudXBkYXRlUmVzdGF1cmFudENvbnRhaW5lckFyaWEgPSAoKSA9PiB7XG4gIGNvbnN0IHJlc3RhdXJhbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jb250YWluZXInKTtcbiAgY29uc3QgYWNjZXNzaWJsZVJlc3RhdXJhbnRDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjZXNzaWJsZS1yZXN0YXVyYW50LWNvbnRhaW5lcicpO1xuICBpZiAobWF0Y2hlc01lZGlhUXVlcnkpIHsgLy8gbGFyZ2VyIGxheW91dCwgc2NyZWVuIHJlYWRpbmcgb3JkZXIgb2ZmXG4gICAgcmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgICBhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ2ZhbHNlJyk7XG4gIH0gZWxzZSB7IC8vIHVzZSByZWd1bGFyIHJlYWRpbmcgb3JkZXJcbiAgICByZXN0YXVyYW50Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAnZmFsc2UnKTtcbiAgICBhY2Nlc3NpYmxlUmVzdGF1cmFudENvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJywgJ3RydWUnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cbmZldGNoUmVzdGF1cmFudEZyb21VUkwgPSAoY2FsbGJhY2spID0+IHtcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpO1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCc7XG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICB9IGVsc2Uge1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcbiAgICB9KTtcbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2VcbiAqL1xuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LW5hbWUnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG5cbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWFkZHJlc3MnKTtcbiAgYWRkcmVzcy5pbm5lckhUTUwgKz0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IHBpY3R1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1waWN0dXJlJyk7XG5cbiAgY29uc3Qgc291cmNlTGFyZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlTGFyZ2UubWVkaWEgPSAnKG1pbi13aWR0aDogODAwcHgpJztcbiAgc291cmNlTGFyZ2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ2xhcmdlJywgd2lkZTogdHJ1ZSB9KTtcbiAgc291cmNlTGFyZ2UudHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VMYXJnZSk7XG5cbiAgY29uc3Qgc291cmNlTWVkaXVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc291cmNlJyk7XG4gIHNvdXJjZU1lZGl1bS5tZWRpYSA9ICcobWluLXdpZHRoOiA2MDBweCknO1xuICBzb3VyY2VNZWRpdW0uc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ21lZGl1bScgfSk7XG4gIHNvdXJjZU1lZGl1bS50eXBlID0gJ2ltYWdlL2pwZWcnO1xuICBwaWN0dXJlLmFwcGVuZENoaWxkKHNvdXJjZU1lZGl1bSk7XG5cbiAgY29uc3Qgc291cmNlU21hbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcbiAgc291cmNlU21hbGwuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHsgc2l6ZTogJ3NtYWxsJyB9KTtcbiAgc291cmNlU21hbGwudHlwZSA9ICdpbWFnZS9qcGVnJztcbiAgcGljdHVyZS5hcHBlbmRDaGlsZChzb3VyY2VTbWFsbCk7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgLy8gc2V0IGRlZmF1bHQgc2l6ZSBpbiBjYXNlIHBpY3R1cmUgZWxlbWVudCBpcyBub3Qgc3VwcG9ydGVkXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2UuYWx0ID0gcmVzdGF1cmFudC5hbHQ7XG4gIHBpY3R1cmUuYXBwZW5kQ2hpbGQoaW1hZ2UpO1xuXG4gIGNvbnN0IGFjY2Vzc2libGVSZXN0YXVyYW50SW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWNjZXNzaWJsZS1yZXN0YXVyYW50LWltZycpO1xuICBhY2Nlc3NpYmxlUmVzdGF1cmFudEltYWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIHJlc3RhdXJhbnQuYWx0KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IGBDdWlzaW5lOiAke3Jlc3RhdXJhbnQuY3Vpc2luZV90eXBlfWA7XG5cbiAgY29uc3QgYWNjZXNzaWJsZVJlc3RhdXJhbnRDdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY2Vzc2libGUtcmVzdGF1cmFudC1jdWlzaW5lJyk7XG4gIGFjY2Vzc2libGVSZXN0YXVyYW50Q3Vpc2luZS5pbm5lckhUTUwgPSBgQ3Vpc2luZTogJHtyZXN0YXVyYW50LmN1aXNpbmVfdHlwZX1gO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGNvbnN0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob3BlcmF0aW5nSG91cnMsIGtleSkpIHtcbiAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG5cbiAgICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xuXG4gICAgICBob3Vycy5hcHBlbmRDaGlsZChyb3cpO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuY3JlYXRlUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcbiAgY29uc3QgYXJ0aWNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2FydGljbGUnKTtcbiAgYXJ0aWNsZS5jbGFzc05hbWUgPSAncmV2aWV3JztcblxuICBjb25zdCBoZWFkZXJTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBoZWFkZXJTcGFuLmNsYXNzTmFtZSA9ICdyZXZpZXctaGVhZGVyJztcblxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXZpZXctbmFtZSc7XG4gIGhlYWRlclNwYW4uYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBoZWFkZXJTcGFuLmFwcGVuZENoaWxkKGRhdGUpO1xuICBhcnRpY2xlLmFwcGVuZENoaWxkKGhlYWRlclNwYW4pO1xuXG4gIGNvbnN0IGNvbnRlbnRTcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICBjb250ZW50U3Bhbi5jbGFzc05hbWUgPSAncmV2aWV3LWNvbnRlbnQnO1xuXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xuICByYXRpbmcuY2xhc3NOYW1lID0gJ3Jldmlldy1yYXRpbmcnO1xuICBjb250ZW50U3Bhbi5hcHBlbmRDaGlsZChyYXRpbmcpO1xuXG4gIGNvbnN0IGNvbW1lbnRzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XG4gIGNvbnRlbnRTcGFuLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcbiAgYXJ0aWNsZS5hcHBlbmRDaGlsZChjb250ZW50U3Bhbik7XG5cbiAgcmV0dXJuIGFydGljbGU7XG59O1xuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xuICB1cmwgPSB1cmwgfHwgd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCk7XG5cblxuICBjb25zdCByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cbnJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcbiAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xuXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc2VydmljZS13b3JrZXIuanMnKVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmxvZyhlcnJvcikpO1xufTtcbiJdLCJmaWxlIjoicmVzdGF1cmFudF9pbmZvLmpzIn0=
